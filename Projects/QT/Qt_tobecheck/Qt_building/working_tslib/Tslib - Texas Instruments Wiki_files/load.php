mw.loader.implement("ext.livetranslate",function(){(function($){$.fn.replaceText=function(b,a,c){return this.each(function(){var f=this.firstChild,g,e,d=[];if(f){do{if(f.nodeType===3){g=f.nodeValue;e=g.replace(b,a);if(e!==g){if(!c&&/</.test(e)){$(f).before(e);d.push(f)}else{f.nodeValue=e}}}}while(f=f.nextSibling)}d.length&&$(d).remove()})};})(window.jQuery);(function(){var lt={debug:function(message){if(window.ltDebugMessages){if(typeof console==='undefined'){document.title='Live Translate: '+message;}else{console.log('Live Translate: '+message);}}},msg:function(){if(typeof mediaWiki==='undefined'){message=window.wgLTEMessages[arguments[0]];for(var i=arguments.length-1;i>0;i--){message=message.replace('$'+i,arguments[i]);}return message;}else{return mediaWiki.msg.apply(this,arguments);}}};window.liveTranslate=lt;}());(function($,lt){lt.memory=function(options){this.words={};this.translations={};this.options={lsprefix:'mw_lt_'};this.cleanedLS=false;$.extend(this.options,options);};lt.
memory.singleton=function(){if(typeof lt.memoryinstance==='undefined'){lt.memoryinstance=new lt.memory();}return lt.memoryinstance;}
lt.memory.prototype={canUseLocalStorage:function(){try{return'localStorage'in window&&window['localStorage']!==null;}catch(e){return false;}},obtainFromLS:function(itemName){return JSON.parse(localStorage.getItem(this.options.lsprefix+itemName));},writeToLS:function(itemName,object){localStorage.setItem(this.options.lsprefix+itemName,JSON.stringify(object))},removeFromLS:function(itemName){lt.debug('tm: removing item from LS: '+this.options.lsprefix+itemName);localStorage.removeItem(this.options.lsprefix+itemName);},getMemoryHashes:function(args,callback){var defaults={apiPath:window.wgScriptPath};args=$.extend({},defaults,args);$.getJSON(args.apiPath+'/api.php',{'action':'query','list':'translationmemories','format':'json','qtmprops':'version_hash'},function(data){if(data.memories){callback(data.memories);}else{lt.debug('tm: failed to fetch memory hash');}});},hashesMatch:function(a,b){if(a===null||b===null){return false;}for(i in a){if(b[i]){if(a[i].memory_version_hash!==b[i].
memory_version_hash){return false;}}else{return false;}}for(i in b){if(!a[i]){return false;}}return true;},cleanLocalStorage:function(options,callback){options=$.extend({},{forceCheck:false},options);if(this.cleanedLS&&!options.forceCheck){callback();}else{var _this=this;lt.debug('tm: getting memory hashes');this.getMemoryHashes({},function(memories){if(_this.hashesMatch(_this.obtainFromLS('hash'),memories)){lt.debug('tm: memory hashes obtained: match');}else{_this.removeFromLS('words');_this.removeFromLS('translations');_this.writeToLS('hash',memories);lt.debug('tm: memory hashes obtained: no match; LS cleared');}_this.cleanedLS=true;callback();});}},obtainTranslationsFromServer:function(args,callback){var defaults={offset:-1,words:[],language:'en',apiPath:window.wgScriptPath};args=$.extend({},defaults,args);lt.debug('tm: obtaining translations from server');$.getJSON(args.apiPath+'/api.php',{'action':'livetranslate','format':'json','from':args.source,'to':args.target,'words':args.
words.join('|')},function(data){if(data.translations){lt.debug('tm: obtained translations from server');callback(data.translations);}else{}});},obtainWordsFromServer:function(args,callback){var _this=this;var defaults={offset:-1,allWords:[],language:'en',apiPath:window.wgScriptPath};args=$.extend({},defaults,args);lt.debug('tm: obtaining special words from server, offset '+args.offset);var requestArgs={'action':'query','format':'json','list':'livetranslate','ltlanguage':args.language};if(args.offset>0){requestArgs['ltcontinue']=args.offset;}$.getJSON(args.apiPath+'/api.php',requestArgs,function(data){if(data.words){args.allWords.push.apply(args.allWords,data.words);}else{}if(data['query-continue']){_this.obtainWordsFromServer({offset:data['query-continue'].livetranslate.ltcontinue,language:args.language,allWords:args.allWords},callback);}else{lt.debug('tm: obtained special words from server');callback(args.allWords);}});},getTranslations:function(args,callback){var _this=this;var
defaults={source:'en',target:'en',words:[]};var translations={};args=$.extend({},defaults,args);if(!this.translations[args.source]){this.translations[args.source]={};}var mergeInTranslations=function(words){lt.debug('tm: merging in translations');var wordsAdded=[];$.each(args.words,function(index,word){if(!!words[word]){translations[word]=words[word];_this.translations[args.source][args.target][word]=words[word];wordsAdded.push(index);}});args.words=$.grep(args.words,function(e,index){return $.inArray(index,wordsAdded)===-1;});};var getFromServer=function(){_this.obtainTranslationsFromServer(args,function(obtainedTranslations){mergeInTranslations(obtainedTranslations);if(_this.canUseLocalStorage()){_this.writeToLS('translations',_this.translations);lt.debug('tm: wrote translations to LS');}callback(translations);});};if(this.translations[args.source][args.target]){mergeInTranslations(this.translations[args.source][args.target]);}else{this.translations[args.source][args.target]={};}if(
args.words.length==0){callback(translations);}else{if(this.canUseLocalStorage()){this.cleanLocalStorage({},function(){var lsTranslations=_this.obtainFromLS('translations');if(lsTranslations!==null&&lsTranslations[args.source]&&lsTranslations[args.source][args.target]){mergeInTranslations(lsTranslations[args.source][args.target]);}if(args.words.length==0){callback(translations);}else{getFromServer();}});}else{getFromServer();}}},getSpecialWords:function(language,callback){var _this=this;var getFromServer=function(){_this.obtainWordsFromServer({language:language},function(words){_this.words[language]=words;if(_this.canUseLocalStorage()){_this.writeToLS('words',_this.words);lt.debug('tm: wrote special words to LS');}callback(words);});};if(this.words[language]){callback(this.words[language]);}else{if(this.canUseLocalStorage()){this.cleanLocalStorage({},function(){var words=_this.obtainFromLS('words');if(words!==null&&words[language]){callback(words[language]);}else{getFromServer();}});}
else{getFromServer();}}}};})(jQuery,window.liveTranslate);(function($,lt){$.fn.liveTranslate=function(options){RegExp.escape=function(text){if(!arguments.callee.sRE){var specials=['/','.','*','+','?','|','(',')','[',']','{','}','\\'];arguments.callee.sRE=new RegExp('(\\'+specials.join('|\\')+')','g');}return text.replace(arguments.callee.sRE,'\\$1');};var _this=this;this.doTranslations=function(){_this.runningJobs=2;_this.doLocalTranslation(_this.completeTranslationProcess);_this.doRemoteTranslation(_this.completeTranslationProcess);};this.findSpecialWords=function(){var words=[];$.each($("span.notranslate"),function(i,v){words.push($.trim($(v).text()));});return words;};this.doLocalTranslation=function(callback){_this.memory.getTranslations({source:_this.currentLang,target:_this.select.val(),words:_this.findSpecialWords()},function(translations){$.each($("span.notranslate"),function(i,v){var currentText=$(v).text();var trimmedText=$.trim(currentText);if(translations[trimmedText]){$(v)
.text(currentText.replace(trimmedText,translations[trimmedText]));}});callback();});};this.doRemoteTranslation=function(callback){var translator=new window.translationService();translator.done=callback;lt.debug('Initiating remote translation');translator.translateElement($('#bodyContent'),_this.currentLang,_this.select.val());};this.completeTranslationProcess=function(){if(!--_this.runningJobs){_this.translateButton.attr("disabled",false).text(lt.msg('livetranslate-button-translate'));_this.select.attr("disabled",false);_this.revertButton.css('display','inline');}};this.insertSpecialWords=function(words){lt.debug('inserting special words');for(i in words){$('#bodyContent *').replaceText(new RegExp("(\\W)*"+RegExp.escape(words[i])+"(\\W)*","g"),function(str){return'<span class="notranslate">'+str+'</span>';});}};this.obatinAndInsetSpecialWords=function(callback){_this.memory.getSpecialWords(_this.currentLang,function(specialWords){_this.specialWords=specialWords;_this.insertSpecialWords
(specialWords);callback();});};this.setup=function(){var defaults={languages:{},sourcelang:'en'};$.extend(options,defaults);$.each(this.attr('languages').split('||'),function(i,lang){var parts=lang.split('|');options.languages[parts[0]]=parts[1];});_this.currentLang=this.attr('sourcelang');_this.originalHtml=false;_this.textAreaElement=document.createElement('textarea');_this.uniqueId=Math.random().toString().substring(2);_this.memory=lt.memory.singleton();_this.runningJobs=0;_this.buildHtml();_this.bindEvents();_this.autoTranslate(_this.currentLang);};this.buildHtml=function(){_this.attr({style:'display:inline; float:right'}).attr('class','notranslate');_this.html(lt.msg('livetranslate-translate-to'));_this.select=$('<select />').attr({id:'ltselect'+_this.uniqueId});for(langCode in options.languages){_this.select.append($('<option />').attr('value',langCode).text(options.languages[langCode]));}_this.translateButton=$('<button />').attr({id:'livetranslatebutton'+_this.uniqueId}).text(
lt.msg('livetranslate-button-translate'));_this.revertButton=$('<button />').attr({id:'ltrevertbutton'+_this.uniqueId,style:'display:none'}).text(lt.msg('livetranslate-button-revert'));_this.append(_this.select,_this.translateButton,_this.revertButton);};this.bindEvents=function(){_this.translateButton.click(function(){_this.originalHtml=$('#bodyContent').html();$(this).attr("disabled",true).text(lt.msg('livetranslate-button-translating'));_this.select.attr("disabled",true);_this.obatinAndInsetSpecialWords(_this.doTranslations);_this.setCookie();});_this.revertButton.click(function(){$('#bodyContent').html(_this.originalHtml);_this.select=$('#ltselect'+_this.uniqueId);_this.translateButton=$('#livetranslatebutton'+_this.uniqueId);_this.revertButton=$('#ltrevertbutton'+_this.uniqueId);_this.bindEvents();_this.unsetCookie();});};this.autoTranslate=function(currentLang){if(_this.attr('autolang')===currentLang){return;}_this.select.val(this.attr('autolang'));_this.translateButton.click();}
;this.setCookie=function(){document.cookie="lt_user_lang="+_this.select.val()+";expires="+new Date(new Date().getTime()+432000000).toGMTString();};this.unsetCookie=function(){document.cookie="lt_user_lang="+_this.select.val()+";expires="+new Date(new Date().getTime()-432000000).toGMTString();};this.setup();return this;};})(window.jQuery,window.liveTranslate);(function($){$(document).ready(function(){$('#livetranslatediv').liveTranslate({});});})(jQuery);;},{},{"livetranslate-button-translate":"Translate","livetranslate-button-translating":"Translating...","livetranslate-dictionary-error":"Could not obtain the live translate dictionary. No words will be treated as special during the translation process.","livetranslate-button-revert":"Show original","livetranslate-translate-to":"Translate this page to"});mw.loader.implement("ext.lt.ms",function(){(function($,lt){window.translationService=function(){var self=this;this.done=function(){};this.runningJobs=0;this.checkingForIdle=false;this.
lastCompletion;this.textAreaElement=document.createElement('textarea');this.translateChunk=function(untranslatedsentences,chunks,currentMaxSize,sourceLang,targetLang,element){lt.debug('MS: Translating chunk');var remainingPart=false;var partToUse=false;var sentenceCount=0;var currentLength=0;for(i in untranslatedsentences){sentenceCount++;if(currentLength+untranslatedsentences[i].length<currentMaxSize){currentLength+=untranslatedsentences[i].length;}else if(untranslatedsentences[i].length>0){if(currentLength==0){partToUse=untranslatedsentences[i].substr(0,currentMaxSize-currentLength);remainingPart=untranslatedsentences[i].substr(currentMaxSize-currentLength);}break;}}var chunk='';for(i=0;i<sentenceCount;i++){var part=untranslatedsentences.shift();if(i!=sentenceCount-1||partToUse===false){chunk+=part;}}if(remainingPart!==false){untranslatedsentences.unshift(remainingPart);}if(partToUse!==false){chunk+=partToUse;}if(chunk.length==0){this.handleTranslationCompletion();return;}var
leadingSpace=chunk.substr(0,1)==' '?' ':'';var tailingSpace=(chunk.length>1&&chunk.substr(chunk.length-1,1)==' ')?' ':'';var chunckTranslationDone=function(translation){lt.debug('MS: Translated chunk');if(typeof translation!=='undefined'){chunks.push(leadingSpace+translation+tailingSpace);}else{chunks.push(chunk);}if(untranslatedsentences.length==0){self.textAreaElement.innerHTML=chunks.join('');element.replaceData(0,element.length,self.textAreaElement.value);lt.debug('MS: Translated element');self.handleTranslationCompletion();}else{self.translateChunk(untranslatedsentences,chunks,currentMaxSize,sourceLang,targetLang,element);}};$.getJSON('http://api.microsofttranslator.com/V2/Ajax.svc/Translate?oncomplete=?',{'appId':window.ltMsAppId,'from':sourceLang,'to':targetLang,'text':$.trim(chunk)},chunckTranslationDone);}
this.translateElement=function(element,sourceLang,targetLang){lt.debug('MS: Translating element');this.runningJobs++;var maxChunkLength=500;element.contents().each(function(){lt.debug('MS: Element conent item');if(this.nodeType==3&&typeof this.data==='string'&&$.trim(this.data).length>0){lt.debug('MS: Found content node');self.runningJobs++;self.translateChunk(this.data.split(new RegExp("([.!?])(?=\\s+|$)","gi")),[],maxChunkLength,sourceLang,targetLang,this);}else if(this.nodeType!=3&&$.inArray($(this).attr('id'),['siteSub','jump-to-nav'])==-1&&!$(this).hasClass('notranslate')&&!$(this).hasClass('printfooter')&&$(this).text().length>0){lt.debug('MS: Found child node');self.translateElement($(this),sourceLang,targetLang);}else{lt.debug('MS: Found ignore node');}});this.handleTranslationCompletion();}
this.invokeDone=function(){lt.debug('MS: translation process done');lt.debug(this.runningJobs);this.runningJobs=0;this.done();}
this.checkForIdleness=function(hits){lt.debug('MS: checkForIdleness');lt.debug('MS: last + 250: '+(this.lastCompletion+250));lt.debug('MS: now: '+(new Date()).getTime());if(this.lastCompletion+250<(new Date()).getTime()){hits++;}else{hits=0;}if(hits>4){this.invokeDone();}else if(this.runningJobs>0){setTimeout(function(){self.checkForIdleness(hits);},250);}}
this.handleTranslationCompletion=function(){if(!this.checkingForIdle&&this.runningJobs>1&&this.runningJobs<20){this.checkingForIdle=true;setTimeout(function(){self.checkForIdleness(0);},250);}if(this.checkingForIdle){this.lastCompletion=(new Date()).getTime();}if(!--this.runningJobs){this.invokeDone();}}};})(jQuery,window.liveTranslate);;},{},{});
/* cache key: davincid_wikidb:resourceloader:filter:minify-js:7:a912f179ecb8c0a87325151804136718 */